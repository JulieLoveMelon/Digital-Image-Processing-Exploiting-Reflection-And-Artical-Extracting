clc;
clear all;
image=imread('bhw2.jpg');

%% 制作掩模
[m, n]=size(image);
n=n/3;
img_hsv=rgb2hsv(image);
mask=zeros(size(image));
for i=1:m
    for j=1:n
        if(img_hsv(i,j,3) > 0.9)
            mask(i,j,:)=0;
        else
            mask(i,j,:)=image(i,j,:);
        end
    end
end
figure, imshow(mask);

%% 去反光
[ img1 ] = qufanguagn2(image);
result=zeros(size(image));
image1=im2double(image);
for i=1:m
    for j=1:n
        if mask(i,j,1)==0
            result(i,j,:)=img1(i,j,:);
        else
            result(i,j,:)=image1(i,j,:);
        end
    end
end
figure, imshow(result);

%% 找到工件轮廓
[ boundary ] = lunkuo( image );
figure, imshow(boundary);

%% 分离工件
result = im2uint8( result );
[ resultImage ] = fenli3( result, boundary);
figure, imshow( uint8( resultImage ) );